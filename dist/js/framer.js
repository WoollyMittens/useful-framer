var Framer=function(f){this.cfg=f,this.cfg.frame=f.element.querySelector("figcaption"),this.cfg.picture=f.element.querySelector("img"),this.touches=null,this.init=function(){if(!f.picture.offsetHeight)return!1;f.aspect&&this.setAspect(f.aspect),this.centerCoordinates(f.left,f.top,f.size)},this.setAspect=function(t){var e=Math.min(.9,.9*f.aspect),i=Math.min(.9,1/f.aspect*.9);f.frame.style.top=50*(1-i)+"%",f.frame.style.right=50*(1-e)+"%",f.frame.style.bottom=f.frame.style.top,f.frame.style.left=f.frame.style.right},this.centerCoordinates=function(t,e,i){var s=f.picture.offsetWidth/f.picture.offsetHeight,n=f.aspect/s;this.setCoordinates(void 0===t?Math.max(1-n,0)/2:t,void 0===e?Math.max(1-1/n,0)/2:e,void 0===i?1:i)},this.limitCoordinates=function(t,e,i){var s=f.picture.offsetWidth/f.picture.offsetHeight,n=f.aspect/s,o=Math.min(n,1);i=Math.min(Math.max(i,.25),o);var h=Math.max(1-i,0);t=Math.min(Math.max(t,0),h);var a=Math.max(1-i/n,0);e=Math.min(Math.max(e,0),a),f.left=t,f.top=e,f.size=i},this.setCoordinates=function(t,e,i){this.limitCoordinates(t,e,i);var s=f.frame.offsetWidth/f.picture.offsetWidth/f.size,n=f.frame.offsetLeft-f.left*f.picture.offsetWidth*s,o=f.frame.offsetTop-f.top*f.picture.offsetHeight*s;f.picture.style.transform="translate3d("+n+"px, "+o+"px, 0) scale3d("+s+", "+s+", 1)",this.reportValues()},this.moveLeft=function(t){t=t||.1,this.setCoordinates(f.left-t,f.top,f.size)},this.moveRight=function(t){t=t||.1,this.setCoordinates(f.left+t,f.top,f.size)},this.moveUp=function(t){t=t||.1,this.setCoordinates(f.left,f.top-t,f.size)},this.moveDown=function(t){t=t||.1,this.setCoordinates(f.left,f.top+t,f.size)},this.zoomIn=function(t){var e=(1-(t=t||.9))/4;this.setCoordinates(f.left+e,f.top+e,f.size*t)},this.zoomOut=function(t){var e=(1-(t=t||.9))/4;this.setCoordinates(f.left-e,f.top-e,f.size/t)},this.resetAll=function(){this.centerCoordinates()},this.reportValues=function(){this.cfg.output&&this.cfg.output(f)},this.onTouched=function(t){this.touches=t.touches||[t]},this.onDragged=function(t){if(this.touches){var e,i,s,n;t.preventDefault();var o=t.touches||[t];switch(o.length){case 2:e=Math.abs(o[0].clientX-o[1].clientX)-Math.abs(this.touches[0].clientX-this.touches[1].clientX),i=Math.abs(o[0].clientY-o[1].clientY)-Math.abs(this.touches[0].clientY-this.touches[1].clientY),s=e/f.element.offsetWidth,n=i/f.element.offsetHeight,dZ=f.size,this.setCoordinates(f.left+s/4*dZ,f.top+n/4*dZ,f.size-s-n);break;default:e=o[0].clientX-this.touches[0].clientX,i=o[0].clientY-this.touches[0].clientY,s=e/f.element.offsetWidth,n=i/f.element.offsetHeight,dZ=f.size,this.setCoordinates(f.left-s*dZ,f.top-n*dZ,f.size)}this.touches=o}},this.onReleased=function(t){this.touches=null},this.onWheeled=function(t){var e=t.deltaY/f.element.offsetWidth,i=t.deltaY/f.element.offsetHeight,s=f.size;this.setCoordinates(f.left+e/4*s,f.top+i/4*s,f.size-i)},f.element.addEventListener("touchstart",this.onTouched.bind(this)),f.element.addEventListener("touchmove",this.onDragged.bind(this)),f.element.addEventListener("touchend",this.onReleased.bind(this)),f.element.addEventListener("touchcancel",this.onReleased.bind(this)),f.element.addEventListener("mousedown",this.onTouched.bind(this)),f.element.addEventListener("mousemove",this.onDragged.bind(this)),f.element.addEventListener("mouseup",this.onReleased.bind(this)),f.element.addEventListener("mouseout",this.onReleased.bind(this)),f.element.addEventListener("wheel",this.onWheeled.bind(this)),f.picture.addEventListener("load",this.init.bind(this)),this.init()};"undefined"!=typeof define&&define([],function(){return Framer}),"undefined"!=typeof module&&(module.exports=Framer);